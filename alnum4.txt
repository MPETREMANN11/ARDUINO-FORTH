\ from https://github.com/adafruit/Adafruit_LED_Backpack
\ https://learn.adafruit.com/adafruit-led-backpack/0-54-alphanumeric

\ depends on i2c-new.txt, ht16k333.txt

-alnum4
marker -alnum4

: table ( --- )
    create does> ( i -- mask ) swap cells + @ ;

flash
table alnum4.font
    %0000000000000001 , %0000000000000010 , %0000000000000100 ,
    %0000000000001000 , %0000000000010000 , %0000000000100000 ,
    %0000000001000000 , %0000000010000000 , %0000000100000000 ,
    %0000001000000000 , %0000010000000000 , %0000100000000000 ,
    %0001000000000000 , %0010000000000000 , %0100000000000000 ,
    %1000000000000000 , %0000000000000000 , %0000000000000000 ,
    %0000000000000000 , %0000000000000000 , %0000000000000000 ,
    %0000000000000000 , %0000000000000000 , %0000000000000000 ,
    %0001001011001001 , %0001010111000000 , %0001001011111001 ,
    %0000000011100011 , %0000010100110000 , %0001001011001000 ,
    %0011101000000000 , %0001011100000000 ,
    %0000000000000000 , \
    %0000000000000110 , \ !
    %0000001000100000 , \ "
    %0001001011001110 , \ #
    %0001001011101101 , \ $
    %0000110000100100 , \ %
    %0010001101011101 , \ &
    %0000010000000000 , \ '
    %0010010000000000 , \ (
    %0000100100000000 , \ )
    %0011111111000000 , \ *
    %0001001011000000 , \ +
    %0000100000000000 , \ ,
    %0000000011000000 , \ -
    %0000000000000000 , \ .
    %0000110000000000 , \ /
    %0000110000111111 , \ 0
    %0000000000000110 , \ 1
    %0000000011011011 , \ 2
    %0000000010001111 , \ 3
    %0000000011100110 , \ 4
    %0010000001101001 , \ 5
    %0000000011111101 , \ 6
    %0000000000000111 , \ 7
    %0000000011111111 , \ 8
    %0000000011101111 , \ 9
    %0001001000000000 , \ :
    %0000101000000000 , \ ;
    %0010010000000000 , \ <
    %0000000011001000 , \ =
    %0000100100000000 , \ >
    %0001000010000011 , \ ?
    %0000001010111011 , \ @
    %0000000011110111 , \ A
    %0001001010001111 , \ B
    %0000000000111001 , \ C
    %0001001000001111 , \ D
    %0000000011111001 , \ E
    %0000000001110001 , \ F
    %0000000010111101 , \ G
    %0000000011110110 , \ H
    %0001001000000000 , \ I
    %0000000000011110 , \ J
    %0010010001110000 , \ K
    %0000000000111000 , \ L
    %0000010100110110 , \ M
    %0010000100110110 , \ N
    %0000000000111111 , \ O
    %0000000011110011 , \ P
    %0010000000111111 , \ Q
    %0010000011110011 , \ R
    %0000000011101101 , \ S
    %0001001000000001 , \ T
    %0000000000111110 , \ U
    %0000110000110000 , \ V
    %0010100000110110 , \ W
    %0010110100000000 , \ X
    %0001010100000000 , \ Y
    %0000110000001001 , \ Z
    %0000000000111001 , \ [
    %0010000100000000 , \
    %0000000000001111 , \ ]
    %0000110000000011 , \ ^
    %0000000000001000 , \ _
    %0000000100000000 , \ `
    %0001000001011000 , \ a
    %0010000001111000 , \ b
    %0000000011011000 , \ c
    %0000100010001110 , \ d
    %0000100001011000 , \ e
    %0000000001110001 , \ f
    %0000010010001110 , \ g
    %0001000001110000 , \ h
    %0001000000000000 , \ i
    %0000000000001110 , \ j
    %0011011000000000 , \ k
    %0000000000110000 , \ l
    %0001000011010100 , \ m
    %0001000001010000 , \ n
    %0000000011011100 , \ o
    %0000000101110000 , \ p
    %0000010010000110 , \ q
    %0000000001010000 , \ r
    %0010000010001000 , \ s
    %0000000001111000 , \ t
    %0000000000011100 , \ u
    %0010000000000100 , \ v
    %0010100000010100 , \ w
    %0010100011000000 , \ x
    %0010000000001100 , \ y
    %0000100001001000 , \ z
    %0000100101001001 , \ {
    %0001001000000000 , \ |
    %0010010010001001 , \ }
    %0000010100100000 , \ ~
    %0011111111111111 ,
ram

variable alnum4.buffer 8 allot

: alnum4.init ( addr --- )
    ht16k33.init ;

\ : alnum4.erase ( --- )
\     alnum4.buffer 8 erase ;


: alnum4.raw ( mask n --- )
    cell * alnum4.buffer + ! ;

: alnum4.char ( a d n --- )
    >r
    if [ 1 14 lshift ] then 0 else
    swap
    alnum4.font +
    or
    r> alnum4.raw ;

\ -alnum4-test
\ marker -alnum4-test

char :noname ( a d n ) r> if 